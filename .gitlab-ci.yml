stages:
  - test
  - build


lint:
  stage: test
  needs: []
  image: registry.gitlab.com/mbarkhau/pylint-ignore/base
  script:
    - make lint
    - make mypy
  artifacts:
    paths:
      - mypycov/
  allow_failure: false

unit:
  stage: test
  needs: []
  image: registry.gitlab.com/mbarkhau/pylint-ignore/base
  script:
    - make lint
    - make mypy
    - make test
  coverage: '/^(TOTAL|src).*?(\d+\%)$/'
  artifacts:
    paths:
      - mypycov/
  allow_failure: false


pages:
  stage: build
  script:
    - mkdir -p public/cov
    - mkdir -p public/mypycov
    - cp -r htmlcov/* public/cov/
    - cp -r mypycov/* public/mypycov/
  artifacts:
    paths:
      - public
  only:
    - master
